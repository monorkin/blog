# Name of your application. Used to uniquely configure containers.
service: blog

# Name of the container image.
image: monorkin/blog

# Deploy to these servers.
servers:
  web:
    hosts:
      - shire.stanko.io

# Proxy settings
proxy:
  ssl: true
  host: stanko.io
  app_port: 3000
  healthcheck:
    path: /up
    interval: 3
    timeout: 30

# Credentials for your image host.
registry:
  username: monorkin
  password:
    - KAMAL_REGISTRY_PASSWORD

# Docker image builder configuration
builder:
  arch:
    - amd64

# Inject ENV variables into containers (secrets come from .env).
env:
  clear:
    RAILS_ENV: "production"
    RAILS_MAX_THREADS: "10"
    WEB_CONCURRENCY: "4"
    REDIS_URL: "redis://redis.stanko.io:6379/0"
  secret:
    - RAILS_MASTER_KEY
    - APPSIGNAL_PUSH_API_KEY

# Call a broadcast command on deploys.
# audit_broadcast_cmd:
#   bin/broadcast_to_bc

# Use a different ssh user than root
ssh:
  user: ubuntu
